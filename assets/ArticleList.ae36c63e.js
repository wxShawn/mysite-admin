import{A as y,au as x,M as w,r as P,h as A,I as v,z as T,o as B,O as N,av as L,B as S,C as U,F as a,an as I,E as g,aw as M,D as s,a2 as O,H as _,N as R,G as E,J as H,K as D}from"./index.c8a34d21.js";import{N as j}from"./Switch.9492b63c.js";import{u as q,N as G}from"./use-dialog.5e9f1785.js";import{N as J}from"./DataTable.29d164eb.js";import"./Pagination.1ab31228.js";const K=b=>{const i=y({title:"",category:0}),p={category:{validator(t,n){return typeof n!="number"?new Error("\u5206\u7C7BID\u683C\u5F0F\u9519\u8BEF"):!0},trigger:"blur"}},r=y([{label:"\u5168\u90E8",value:0}]),f=()=>{Object.assign(i,{title:"",category:0})},o=async t=>{try{await b.value.validate()}catch(n){return console.log(n),!1}t(i.title,i.category)},h=async()=>{const t=await w.category.findAll();if(t.code===0){const{rows:n}=t.result;for(let e=0,l=n.length;e<l;e++)r.push({label:n[e].name,value:n[e].id})}};return x(()=>{h()}),{formValue:i,rules:p,categoryOptions:r,reset:f,search:o}},$=()=>{const b=[{title:"#",key:"index"},{title:"\u6807\u9898",key:"title"},{title:"\u5206\u7C7B",key:"category"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"createdAt"},{title:"\u66F4\u65B0\u65F6\u95F4",key:"updatedAt"},{title:"\u53D1\u5E03",key:"publish",render(e){return A(j,{value:e.isPublish,"onUpdate:value":async l=>{e.isPublish=l,r.publish(e.id,l)}})}},{title:"\u64CD\u4F5C",key:"actions",render(e){return[A(v,{ghost:!0,style:"margin-right: 12px",type:"info",size:"small",onClick:()=>r.edit(e.id)},{default:()=>"\u7F16\u8F91"}),A(v,{ghost:!0,type:"error",size:"small",onClick:()=>r.delete(e.id)},{default:()=>"\u5220\u9664"})]}}],i=y([]),p=P(!1),r=y({publish:(e,l)=>console.log("publish changed",{id:e,value:l}),edit:e=>console.log("click edit",{id:e}),delete:e=>console.log("click delete",{id:e})}),f=async e=>await w.article.delete(e),o=async(e,l)=>await w.article.updatePublishState(e,l),h=async(e,l)=>{if(!p.value){p.value=!0;const{page:c,pageSize:u}=t,k=await w.article.findAll(c,u,e,l);if(k.code===0){const{count:C,rows:m}=k.result;t.itemCount=C,i.length=0;for(let d=0,z=m.length;d<z;d++){const F=new Date(m[d].createdAt).toLocaleString(),V=new Date(m[d].updatedAt).toLocaleString();i.push({index:(c-1)*u+d+1,id:m[d].id,title:m[d].title,category:m[d].blog_category.name,createdAt:F,updatedAt:V,isPublish:m[d].isPublish})}}p.value=!1}};x(()=>{h()});const t=y({page:1,pageSize:10,itemCount:100,showSizePicker:!0,pageSizes:[{label:"10/\u9875",value:10},{label:"20/\u9875",value:20},{label:"30/\u9875",value:30}],prefix(){return`\u5171 ${t.itemCount} \u7BC7\u6587\u7AE0`},onChange(e){t.page=e,n.change()},onUpdatePageSize(e){t.pageSize=e,t.page=1,n.change()}}),n=y({change(){}});return{columns:b,articleData:i,pagination:t,getData:h,deleteArticle:f,updatePublishState:o,loading:p,action:r,paginationAction:n}},Q=D("\u91CD\u7F6E"),W=D("\u67E5\u8BE2"),X=D("\u6DFB\u52A0\u6587\u7AE0"),le={__name:"ArticleList",setup(b){const i=T(),p=q(),r=B(()=>N.currentRoute.value.name==="ArticleList"),f=P(null),o=K(f),h=()=>{o.search(async(e,l)=>{t.pagination.page=1,await t.getData(e,l)})},t=$();t.action.publish=async(e,l)=>{const c=await t.updatePublishState(e,l);c.code===0&&i.success(c.msg)},t.action.edit=e=>{N.push({name:"UpdateArticle",query:{id:e}})},t.action.delete=e=>{let l=!1;p.warning({title:"\u8B66\u544A",content:"\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F",positiveText:"\u786E\u8BA4\u5220\u9664",negativeText:"\u8003\u8651\u4E00\u4E0B",onPositiveClick:async()=>{if(!l){l=!0;const c=i.loading("\u5220\u9664\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),u=await t.deleteArticle(e);u.code===0&&(i.success(u.msg),o.search(async(k,C)=>{await t.getData(k,C)})),c.destroy(),l=!1}},onNegativeClick:()=>{}})},t.paginationAction.change=()=>{o.search(async(e,l)=>{await t.getData(e,l)})};const n=()=>{N.push({name:"CreateArticle"})};return(e,l)=>{const c=L("router-view");return S(),U(O,null,[a(r)?(S(),I(a(H),{key:0},{default:g(()=>[s(a(E),{ref_key:"searchFormRef",ref:f,inline:"","label-width":80,model:a(o).formValue,rules:a(o).rules},{default:g(()=>[s(a(_),{label:"\u6807\u9898",path:"title"},{default:g(()=>[s(a(R),{value:a(o).formValue.title,"onUpdate:value":l[0]||(l[0]=u=>a(o).formValue.title=u)},null,8,["value"])]),_:1}),s(a(_),{label:"\u5206\u7C7B",path:"category"},{default:g(()=>[s(a(G),{style:{width:"194px"},value:a(o).formValue.category,"onUpdate:value":l[1]||(l[1]=u=>a(o).formValue.category=u),options:a(o).categoryOptions},null,8,["value","options"])]),_:1}),s(a(_),null,{default:g(()=>[s(a(v),{style:{"margin-right":"18px"},onClick:a(o).reset},{default:g(()=>[Q]),_:1},8,["onClick"]),s(a(v),{disabled:a(t).loading.value,type:"info",onClick:h},{default:g(()=>[W]),_:1},8,["disabled"])]),_:1}),s(a(_),null,{default:g(()=>[s(a(v),{type:"primary",onClick:n},{default:g(()=>[X]),_:1})]),_:1})]),_:1},8,["model","rules"]),s(a(J),{remote:"",columns:a(t).columns,data:a(t).articleData,pagination:a(t).pagination,loading:a(t).loading.value},null,8,["columns","data","pagination","loading"])]),_:1})):M("",!0),s(c)],64)}}};export{le as default};
