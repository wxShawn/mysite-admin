import{bB as N,aJ as I,s as u,w as b,aM as B,r as k,v as A,au as D,z as r,A as s,y as n,B as V,C as M,D as L,E as R}from"./index.f2850c26.js";import{u as T,a as f}from"./index.4ca4f984.js";import{_ as U}from"./MarkdownEditor.f282afbf.js";import{u as q,N as F}from"./use-dialog.650c5c97.js";import{b as y,N as O}from"./FormItem.98cc07c1.js";import"./cssr.4d54ddf6.js";import"./Tag.92152ad8.js";const z=L("\u66F4\u65B0"),K={__name:"UpdateArticle",setup(E){const g=T(),_=q();let d=!0;N((e,t,a)=>{t.name==="UpdateArticle"&&!d?_.warning({title:"\u8B66\u544A",content:"\u79BB\u5F00\u9875\u9762\u540E\u6570\u636E\u5C06\u4E0D\u4F1A\u4FDD\u5B58\uFF0C\u786E\u8BA4\u79BB\u5F00\uFF1F",positiveText:"\u79BB\u5F00",negativeText:"\u4E0D\u79BB\u5F00",onPositiveClick:()=>{a()},onNegativeClick:()=>{a(!1)}}):a()});const p=I().query.id,i=u({text:""}),o=u({title:"",content:i.text});b(o,(e,t)=>{d=i.text===o.content});const v=e=>{o.title=e.title,o.content=e.text},l=u({categoryId:null}),h={categoryId:{required:!0}},m=u([]),x=async()=>{const e=await f.category.findAll();if(e.code===0){const{rows:t}=e.result;for(let a=0,C=t.length;a<C;a++)m.push({label:t[a].name,value:t[a].id})}};B(async()=>{x();const e=await f.article.findOne(p);e.code===0&&(i.text=e.result.content,l.categoryId=e.result.blog_category.id)});const c=k(!1),w=async()=>{if(!c.value){c.value=!0;const e=g.loading("\u66F4\u65B0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),t=await f.article.update(p,o.title,o.content,l.categoryId);t.code===0&&(g.success(t.msg),d=!0,R.push({name:"ArticleList"})),e.destroy(),c.value=!1}};return(e,t)=>(A(),D(s(M),null,{default:r(()=>[n(s(O),{inline:"",model:l,rules:h},{default:r(()=>[n(s(y),{label:"\u9009\u62E9\u5206\u7C7B",path:"categoryId"},{default:r(()=>[n(s(F),{value:l.categoryId,"onUpdate:value":t[0]||(t[0]=a=>l.categoryId=a),options:m,style:{width:"200px"}},null,8,["value","options"])]),_:1}),n(s(y),null,{default:r(()=>[n(s(V),{disabled:c.value,type:"primary",onClick:w},{default:r(()=>[z]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"]),n(U,{data:i,style:{height:"600px"},onDataChange:v},null,8,["data"])]),_:1}))}};export{K as default};
