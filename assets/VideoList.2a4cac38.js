import{u as Q,a as w,c as q}from"./index.fb85aa9c.js";import{_ as G}from"./UploadMedia.e4047f3e.js";import{u as H}from"./use-dialog.3a43aaea.js";import{r as h,s as y,aM as J,v as W,x as X,y as a,z as l,A as o,ac as Y,B as c,C as Z,aN as z,D as g,h as C}from"./index.b6080610.js";import{N as b,b as f}from"./FormItem.13bf696a.js";import{N}from"./Input.ef7e8596.js";import{N as ee}from"./DataTable.ddce88d7.js";import{N as te}from"./a.02305eb9.js";import"./Add.c296693d.js";import"./utils.3f54be48.js";import"./Tooltip.ac57a3e5.js";import"./Tag.864fd4fb.js";import"./cssr.a00ccd03.js";import"./Icon.43d070e7.js";import"./Dropdown.dd479237.js";import"./Pagination.b5c0e903.js";const ae=g("\u67E5\u8BE2"),oe=g("\u6DFB\u52A0\u89C6\u9891"),le=g("\u590D\u5236"),ne=g("\u8FD4\u56DE"),se=g("\u66F4\u65B0"),xe={__name:"VideoList",setup(ie){const m=Q(),S=H(),U=h(null),v=y({name:""}),F=()=>{d.page=1,u()},_=h(!1),M=()=>{u(),_.value=!1},p=h(!1),A=h(null),r=y({id:null,name:"",url:""}),R=(e,t,n)=>{p.value=!0,Object.assign(r,{id:e,name:t,url:n})},D=async()=>{try{await navigator.clipboard.writeText(r.url),m.info("\u5DF2\u590D\u5236URL")}catch(e){console.warn(e),m.info("\u590D\u5236\u5931\u8D25")}},B=async()=>{const e=m.loading("\u66F4\u65B0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),t=await w.media.update(r.id,r.name);t.code===0&&(m.success(t.msg),u()),e.destroy(),p.value=!1},L=e=>{S.warning({title:"\u8B66\u544A",content:"\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F",positiveText:"\u786E\u8BA4\u5220\u9664",negativeText:"\u8003\u8651\u4E00\u4E0B",onPositiveClick:async()=>{const t=m.loading("\u5220\u9664\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0});(await w.media.delete(e)).code===0&&(m.success("\u5220\u9664\u6210\u529F"),u()),t.destroy()},onNegativeClick:()=>{}})},T=[{title:"\u540D\u79F0",key:"name",ellipsis:!0,width:250,render(e){return C(te,{href:e.url,target:"_blank",title:e.name},{default:()=>e.name})}},{title:"\u5927\u5C0F",key:"size"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"createdAt"},{title:"\u66F4\u65B0\u65F6\u95F4",key:"updatedAt"},{title:"\u64CD\u4F5C",key:"actions",render(e){return[C(c,{ghost:!0,type:"info",size:"small",style:"margin-right: 12px;",onclick:()=>R(e.id,e.name,e.url)},{default:()=>"\u7F16\u8F91"}),C(c,{ghost:!0,type:"error",size:"small",onClick:()=>L(e.id)},{default:()=>"\u5220\u9664"})]}}],k=y([]),u=async()=>{const{page:e,pageSize:t}=d,{name:n}=v,x=await w.media.findAllVideo(e,t,n);if(x.code===0){const{count:V,rows:i}=x.result;k.length=0,d.itemCount=V;for(let s=0,$=i.length;s<$;s++){const E=i[s].id,P=i[s].name,I=`${q.REQUEST_URL}/${i[s].path.split("uploads/",2)[1]}`,O=i[s].size>1024*1024?(i[s].size/1024/1024).toFixed(2)+" MB":(i[s].size/1024).toFixed(2)+" KB",j=new Date(i[s].createdAt).toLocaleString(),K=new Date(i[s].updatedAt).toLocaleString();k.push({id:E,name:P,url:I,size:O,createdAt:j,updatedAt:K})}}};J(()=>{u()});const d=y({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[{label:"10/\u9875",value:10},{label:"20/\u9875",value:20},{label:"30/\u9875",value:30}],prefix(){return`\u5171 ${d.itemCount} \u4E2A\u89C6\u9891\u6587\u4EF6`},onChange(e){d.page=e,u()},onUpdatePageSize(e){d.pageSize=e,d.page=1,u()}});return(e,t)=>(W(),X(Y,null,[a(o(Z),null,{default:l(()=>[a(o(b),{ref_key:"searchFormRef",ref:U,inline:"",model:v},{default:l(()=>[a(o(f),{label:"\u89C6\u9891\u540D\u79F0"},{default:l(()=>[a(o(N),{value:v.name,"onUpdate:value":t[0]||(t[0]=n=>v.name=n)},null,8,["value"])]),_:1}),a(o(f),null,{default:l(()=>[a(o(c),{type:"info",onClick:F},{default:l(()=>[ae]),_:1})]),_:1}),a(o(f),null,{default:l(()=>[a(o(c),{type:"primary",onClick:t[1]||(t[1]=n=>_.value=!0)},{default:l(()=>[oe]),_:1})]),_:1})]),_:1},8,["model"]),a(o(ee),{remote:"",columns:T,data:k,pagination:d},null,8,["data","pagination"])]),_:1}),a(o(z),{show:_.value,"onUpdate:show":t[2]||(t[2]=n=>_.value=n),class:"custom-card",preset:"card",style:{width:"500px"},title:"\u4E0A\u4F20\u89C6\u9891"},{default:l(()=>[a(G,{accept:"video/*",onSuccess:M})]),_:1},8,["show"]),a(o(z),{show:p.value,"onUpdate:show":t[5]||(t[5]=n=>p.value=n),preset:"dialog",title:"\u89C6\u9891"},{action:l(()=>[a(o(c),{onClick:t[4]||(t[4]=n=>p.value=!1)},{default:l(()=>[ne]),_:1}),a(o(c),{type:"primary",onClick:B},{default:l(()=>[se]),_:1})]),default:l(()=>[a(o(b),{ref_key:"editFormRef",ref:A,style:{"margin-top":"30px"},"label-placement":"left",model:r},{default:l(()=>[a(o(f),{label:"\u89C6\u9891\u540D\u79F0"},{default:l(()=>[a(o(N),{value:r.name,"onUpdate:value":t[3]||(t[3]=n=>r.name=n)},null,8,["value"])]),_:1}),a(o(f),{label:"\u89C6\u9891\u5730\u5740"},{default:l(()=>[a(o(N),{value:r.url,disabled:""},null,8,["value"]),a(o(c),{style:{"margin-left":"20px"},onClick:D},{default:l(()=>[le]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}};export{xe as default};
