import{u as H,a as w}from"./index.4ca4f984.js";import{p as N}from"./paramsValidator.5d154432.js";import{u as J}from"./use-dialog.650c5c97.js";import{r as P,s as h,aM as K,v as Q,x as W,y as a,z as o,A as l,ac as X,h as j,B as f,C as Y,aN as A,D as y,at as E}from"./index.f2850c26.js";import{N as Z}from"./a.e4497920.js";import{N as ee}from"./Switch.c389e5e1.js";import{N as x,b as s}from"./FormItem.98cc07c1.js";import{N as c}from"./Input.5871983e.js";import{N as te}from"./DataTable.87300680.js";import"./cssr.4d54ddf6.js";import"./Tag.92152ad8.js";import"./Icon.ed41166c.js";import"./Dropdown.980c0394.js";import"./Tooltip.456fc669.js";import"./Pagination.049c3a7b.js";const re=y("\u67E5\u8BE2"),ae=y("\u6DFB\u52A0\u9879\u76EE"),le=E("div",null,"\u6DFB\u52A0\u5206\u7C7B",-1),oe=y("\u53D6\u6D88"),ne=y("\u6DFB\u52A0"),ue=E("div",null,"\u6DFB\u52A0\u5206\u7C7B",-1),ie=y("\u53D6\u6D88"),se=y("\u66F4\u65B0"),je={__name:"ProjectList",setup(de){const S=J(),v=H(),z=P(null),C=h({name:""}),q=()=>{m.page=1,g()},k=P(!1),L=P(null),d=h({name:"",content:"",url:"",cover:""}),M={name:{required:!0,trigger:"blur"},content:{required:!0,trigger:"blur"},url:{required:!0,validator(r,e){return e?N.validate({url:e}).length>0?new Error("url\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199Demo\u5730\u5740")},trigger:"blur"},cover:{required:!0,validator(r,e){return e?N.validate({url:e}).length>0?new Error("cover\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199\u5C01\u9762\u5730\u5740")},trigger:"blur"}};let D=!1;const V=async()=>{try{await L.value.validate()}catch(r){return console.warn(r),!1}if(!D){D=!0;const r=v.loading("\u6DFB\u52A0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),{name:e,content:t,url:p,cover:b}=d,n=await w.project.create(e,t,p,b);n.code===0&&(v.success(n.msg),k.value=!1,g()),r.destroy(),D=!1}},_=P(!1),R=P(null),i=h({id:null,name:"",content:"",url:"",cover:""}),B={name:{required:!0,trigger:"blur"},content:{required:!0,trigger:"blur"},url:{required:!0,validator(r,e){return e?N.validate({url:e}).length>0?new Error("url\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199Demo\u5730\u5740")},trigger:"blur"},cover:{required:!0,validator(r,e){return e?N.validate({url:e}).length>0?new Error("cover\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199\u5C01\u9762\u5730\u5740")},trigger:"blur"}};let F=!1;const T=async()=>{try{await R.value.validate()}catch(r){return console.warn(r),!1}if(!F){F=!0;const r=v.loading("\u6DFB\u52A0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),{id:e,name:t,content:p,url:b,cover:n}=i,u=await w.project.update(e,t,p,b,n);u.code===0&&(v.success(u.msg),_.value=!1,g()),r.destroy(),F=!1}},$=(r,e,t,p,b)=>{_.value=!0,Object.assign(i,{id:r,name:e,content:t,url:p,cover:b})},I=r=>{S.warning({title:"\u8B66\u544A",content:"\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F",positiveText:"\u786E\u8BA4\u5220\u9664",negativeText:"\u8003\u8651\u4E00\u4E0B",onPositiveClick:async()=>{const e=v.loading("\u5220\u9664\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0});(await w.project.delete(r)).code===0&&(v.success("\u5220\u9664\u6210\u529F"),g()),e.destroy()},onNegativeClick:()=>{}})},O=h([{title:"#",key:"index"},{title:"\u9879\u76EE\u540D\u79F0",key:"name",render(r){return j(Z,{href:r.url,target:"_blank",title:r.name},{default:()=>r.name})}},{title:"\u53D1\u5E03",key:"publish",render(r){return j(ee,{value:r.isPublish,"onUpdate:value":async e=>{r.isPublish=e;const t=await w.project.updatePublish(r.id,r.isPublish);t.code===0?v.success(t.msg):r.isPublish=!e}})}},{title:"\u521B\u5EFA\u65E5\u671F",key:"createdAt"},{title:"\u66F4\u65B0\u65E5\u671F",key:"updatedAt"},{title:"\u64CD\u4F5C",key:"actions",render(r){return[j(f,{ghost:!0,type:"info",size:"small",style:"margin-right: 12px;",onclick:()=>$(r.id,r.name,r.content,r.url,r.cover)},{default:()=>"\u7F16\u8F91"}),j(f,{ghost:!0,type:"error",size:"small",onClick:()=>I(r.id)},{default:()=>"\u5220\u9664"})]}}]),U=h([]),g=async()=>{const{page:r,pageSize:e}=m,{name:t}=C,p=await w.project.findAll(r,e,t);if(p.code===0){const{count:b,rows:n}=p.result;U.length=0,m.itemCount=b;for(let u=0,G=n.length;u<G;u++)U.push({index:u+1,id:n[u].id,name:n[u].name,content:n[u].content,url:n[u].url,cover:n[u].cover,isPublish:n[u].isPublish,createdAt:new Date(n[u].createdAt).toLocaleString(),updatedAt:new Date(n[u].updatedAt).toLocaleString()})}};K(()=>{g()});const m=h({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[{label:"10/\u9875",value:10},{label:"20/\u9875",value:20},{label:"30/\u9875",value:30}],prefix(){return`\u5171 ${m.itemCount} \u4E2A\u9879\u76EE`},onChange(r){m.page=r,g()},onUpdatePageSize(r){m.pageSize=r,m.page=1,g()}});return(r,e)=>(Q(),W(X,null,[a(l(Y),null,{default:o(()=>[a(l(x),{ref_key:"searchFormRef",ref:z,inline:"",model:C},{default:o(()=>[a(l(s),{label:"\u9879\u76EE\u540D\u79F0"},{default:o(()=>[a(l(c),{value:C.name,"onUpdate:value":e[0]||(e[0]=t=>C.name=t)},null,8,["value"])]),_:1}),a(l(s),null,{default:o(()=>[a(l(f),{type:"info",onClick:q},{default:o(()=>[re]),_:1})]),_:1}),a(l(s),null,{default:o(()=>[a(l(f),{type:"primary",onClick:e[1]||(e[1]=t=>k.value=!0)},{default:o(()=>[ae]),_:1})]),_:1})]),_:1},8,["model"]),a(l(te),{remote:"",columns:O,data:U,pagination:m},null,8,["columns","data","pagination"])]),_:1}),a(l(A),{show:k.value,"onUpdate:show":e[7]||(e[7]=t=>k.value=t),preset:"dialog",title:"Dialog"},{header:o(()=>[le]),action:o(()=>[a(l(f),{onClick:e[6]||(e[6]=t=>k.value=!1)},{default:o(()=>[oe]),_:1}),a(l(f),{type:"primary",onClick:V},{default:o(()=>[ne]),_:1})]),default:o(()=>[a(l(x),{style:{"margin-top":"30px"},ref_key:"addProjectFormRef",ref:L,"label-width":92,"label-placement":"left",model:d,rules:M},{default:o(()=>[a(l(s),{label:"\u9879\u76EE\u540D\u79F0",path:"name"},{default:o(()=>[a(l(c),{value:d.name,"onUpdate:value":e[2]||(e[2]=t=>d.name=t)},null,8,["value"])]),_:1}),a(l(s),{label:"\u9879\u76EE\u7B80\u4ECB",path:"content"},{default:o(()=>[a(l(c),{value:d.content,"onUpdate:value":e[3]||(e[3]=t=>d.content=t)},null,8,["value"])]),_:1}),a(l(s),{label:"Demo\u5730\u5740",path:"url"},{default:o(()=>[a(l(c),{value:d.url,"onUpdate:value":e[4]||(e[4]=t=>d.url=t)},null,8,["value"])]),_:1}),a(l(s),{label:"\u5C01\u9762\u5730\u5740",path:"cover"},{default:o(()=>[a(l(c),{value:d.cover,"onUpdate:value":e[5]||(e[5]=t=>d.cover=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(l(A),{show:_.value,"onUpdate:show":e[13]||(e[13]=t=>_.value=t),preset:"dialog",title:"Dialog"},{header:o(()=>[ue]),action:o(()=>[a(l(f),{onClick:e[12]||(e[12]=t=>_.value=!1)},{default:o(()=>[ie]),_:1}),a(l(f),{type:"primary",onClick:T},{default:o(()=>[se]),_:1})]),default:o(()=>[a(l(x),{style:{"margin-top":"30px"},ref_key:"editProjectFormRef",ref:R,"label-width":92,"label-placement":"left",model:i,rules:B},{default:o(()=>[a(l(s),{label:"\u9879\u76EE\u540D\u79F0",path:"name"},{default:o(()=>[a(l(c),{value:i.name,"onUpdate:value":e[8]||(e[8]=t=>i.name=t)},null,8,["value"])]),_:1}),a(l(s),{label:"\u9879\u76EE\u7B80\u4ECB",path:"content"},{default:o(()=>[a(l(c),{value:i.content,"onUpdate:value":e[9]||(e[9]=t=>i.content=t)},null,8,["value"])]),_:1}),a(l(s),{label:"Demo\u5730\u5740",path:"url"},{default:o(()=>[a(l(c),{value:i.url,"onUpdate:value":e[10]||(e[10]=t=>i.url=t)},null,8,["value"])]),_:1}),a(l(s),{label:"\u5C01\u9762\u5730\u5740",path:"cover"},{default:o(()=>[a(l(c),{value:i.cover,"onUpdate:value":e[11]||(e[11]=t=>i.cover=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}};export{je as default};
