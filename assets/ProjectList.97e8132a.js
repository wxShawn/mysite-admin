import{z as J,r as w,A as h,au as K,B as O,C as Q,D as r,E as n,F as l,a2 as W,h as j,M as P,G as L,H as s,N as c,I as p,J as X,bs as R,K as y,al as A,L as N}from"./index.c8a34d21.js";import{u as Y}from"./use-dialog.5e9f1785.js";import{N as Z}from"./a.1ebd7155.js";import{N as ee}from"./Switch.9492b63c.js";import{N as te}from"./DataTable.29d164eb.js";import"./Pagination.1ab31228.js";const ae=y("\u67E5\u8BE2"),re=y("\u6DFB\u52A0\u9879\u76EE"),le=A("div",null,"\u6DFB\u52A0\u5206\u7C7B",-1),ne=y("\u53D6\u6D88"),oe=y("\u6DFB\u52A0"),ue=A("div",null,"\u6DFB\u52A0\u5206\u7C7B",-1),ie=y("\u53D6\u6D88"),se=y("\u66F4\u65B0"),be={__name:"ProjectList",setup(de){const S=Y(),v=J(),z=w(null),C=h({name:""}),q=()=>{m.page=1,g()},k=w(!1),x=w(null),d=h({name:"",content:"",url:"",cover:""}),M={name:{required:!0,trigger:"blur"},content:{required:!0,trigger:"blur"},url:{required:!0,validator(a,e){return e?N.validate({url:e}).length>0?new Error("url\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199Demo\u5730\u5740")},trigger:"blur"},cover:{required:!0,validator(a,e){return e?N.validate({url:e}).length>0?new Error("cover\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199\u5C01\u9762\u5730\u5740")},trigger:"blur"}};let D=!1;const V=async()=>{try{await x.value.validate()}catch(a){return console.warn(a),!1}if(!D){D=!0;const a=v.loading("\u6DFB\u52A0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),{name:e,content:t,url:f,cover:b}=d,o=await P.project.create(e,t,f,b);o.code===0&&(v.success(o.msg),k.value=!1,g()),a.destroy(),D=!1}},_=w(!1),E=w(null),i=h({id:null,name:"",content:"",url:"",cover:""}),B={name:{required:!0,trigger:"blur"},content:{required:!0,trigger:"blur"},url:{required:!0,validator(a,e){return e?N.validate({url:e}).length>0?new Error("url\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199Demo\u5730\u5740")},trigger:"blur"},cover:{required:!0,validator(a,e){return e?N.validate({url:e}).length>0?new Error("cover\u683C\u5F0F\u4E0D\u6B63\u786E"):!0:new Error("\u8BF7\u586B\u5199\u5C01\u9762\u5730\u5740")},trigger:"blur"}};let F=!1;const T=async()=>{try{await E.value.validate()}catch(a){return console.warn(a),!1}if(!F){F=!0;const a=v.loading("\u6DFB\u52A0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),{id:e,name:t,content:f,url:b,cover:o}=i,u=await P.project.update(e,t,f,b,o);u.code===0&&(v.success(u.msg),_.value=!1,g()),a.destroy(),F=!1}},$=(a,e,t,f,b)=>{_.value=!0,Object.assign(i,{id:a,name:e,content:t,url:f,cover:b})},I=a=>{S.warning({title:"\u8B66\u544A",content:"\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F",positiveText:"\u786E\u8BA4\u5220\u9664",negativeText:"\u8003\u8651\u4E00\u4E0B",onPositiveClick:async()=>{const e=v.loading("\u5220\u9664\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0});(await P.project.delete(a)).code===0&&(v.success("\u5220\u9664\u6210\u529F"),g()),e.destroy()},onNegativeClick:()=>{}})},G=h([{title:"#",key:"index"},{title:"\u9879\u76EE\u540D\u79F0",key:"name",render(a){return j(Z,{href:a.url,target:"_blank",title:a.name},{default:()=>a.name})}},{title:"\u53D1\u5E03",key:"publish",render(a){return j(ee,{value:a.isPublish,"onUpdate:value":async e=>{a.isPublish=e;const t=await P.project.updatePublish(a.id,a.isPublish);t.code===0?v.success(t.msg):a.isPublish=!e}})}},{title:"\u521B\u5EFA\u65E5\u671F",key:"createdAt"},{title:"\u66F4\u65B0\u65E5\u671F",key:"updatedAt"},{title:"\u64CD\u4F5C",key:"actions",render(a){return[j(p,{ghost:!0,type:"info",size:"small",style:"margin-right: 12px;",onclick:()=>$(a.id,a.name,a.content,a.url,a.cover)},{default:()=>"\u7F16\u8F91"}),j(p,{ghost:!0,type:"error",size:"small",onClick:()=>I(a.id)},{default:()=>"\u5220\u9664"})]}}]),U=h([]),g=async()=>{const{page:a,pageSize:e}=m,{name:t}=C,f=await P.project.findAll(a,e,t);if(f.code===0){const{count:b,rows:o}=f.result;U.length=0,m.itemCount=b;for(let u=0,H=o.length;u<H;u++)U.push({index:u+1,id:o[u].id,name:o[u].name,content:o[u].content,url:o[u].url,cover:o[u].cover,isPublish:o[u].isPublish,createdAt:new Date(o[u].createdAt).toLocaleString(),updatedAt:new Date(o[u].updatedAt).toLocaleString()})}};K(()=>{g()});const m=h({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[{label:"10/\u9875",value:10},{label:"20/\u9875",value:20},{label:"30/\u9875",value:30}],prefix(){return`\u5171 ${m.itemCount} \u4E2A\u9879\u76EE`},onChange(a){m.page=a,g()},onUpdatePageSize(a){m.pageSize=a,m.page=1,g()}});return(a,e)=>(O(),Q(W,null,[r(l(X),null,{default:n(()=>[r(l(L),{ref_key:"searchFormRef",ref:z,inline:"",model:C},{default:n(()=>[r(l(s),{label:"\u9879\u76EE\u540D\u79F0"},{default:n(()=>[r(l(c),{value:C.name,"onUpdate:value":e[0]||(e[0]=t=>C.name=t)},null,8,["value"])]),_:1}),r(l(s),null,{default:n(()=>[r(l(p),{type:"info",onClick:q},{default:n(()=>[ae]),_:1})]),_:1}),r(l(s),null,{default:n(()=>[r(l(p),{type:"primary",onClick:e[1]||(e[1]=t=>k.value=!0)},{default:n(()=>[re]),_:1})]),_:1})]),_:1},8,["model"]),r(l(te),{remote:"",columns:G,data:U,pagination:m},null,8,["columns","data","pagination"])]),_:1}),r(l(R),{show:k.value,"onUpdate:show":e[7]||(e[7]=t=>k.value=t),preset:"dialog",title:"Dialog"},{header:n(()=>[le]),action:n(()=>[r(l(p),{onClick:e[6]||(e[6]=t=>k.value=!1)},{default:n(()=>[ne]),_:1}),r(l(p),{type:"primary",onClick:V},{default:n(()=>[oe]),_:1})]),default:n(()=>[r(l(L),{style:{"margin-top":"30px"},ref_key:"addProjectFormRef",ref:x,"label-width":92,"label-placement":"left",model:d,rules:M},{default:n(()=>[r(l(s),{label:"\u9879\u76EE\u540D\u79F0",path:"name"},{default:n(()=>[r(l(c),{value:d.name,"onUpdate:value":e[2]||(e[2]=t=>d.name=t)},null,8,["value"])]),_:1}),r(l(s),{label:"\u9879\u76EE\u7B80\u4ECB",path:"content"},{default:n(()=>[r(l(c),{value:d.content,"onUpdate:value":e[3]||(e[3]=t=>d.content=t)},null,8,["value"])]),_:1}),r(l(s),{label:"Demo\u5730\u5740",path:"url"},{default:n(()=>[r(l(c),{value:d.url,"onUpdate:value":e[4]||(e[4]=t=>d.url=t)},null,8,["value"])]),_:1}),r(l(s),{label:"\u5C01\u9762\u5730\u5740",path:"cover"},{default:n(()=>[r(l(c),{value:d.cover,"onUpdate:value":e[5]||(e[5]=t=>d.cover=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),r(l(R),{show:_.value,"onUpdate:show":e[13]||(e[13]=t=>_.value=t),preset:"dialog",title:"Dialog"},{header:n(()=>[ue]),action:n(()=>[r(l(p),{onClick:e[12]||(e[12]=t=>_.value=!1)},{default:n(()=>[ie]),_:1}),r(l(p),{type:"primary",onClick:T},{default:n(()=>[se]),_:1})]),default:n(()=>[r(l(L),{style:{"margin-top":"30px"},ref_key:"editProjectFormRef",ref:E,"label-width":92,"label-placement":"left",model:i,rules:B},{default:n(()=>[r(l(s),{label:"\u9879\u76EE\u540D\u79F0",path:"name"},{default:n(()=>[r(l(c),{value:i.name,"onUpdate:value":e[8]||(e[8]=t=>i.name=t)},null,8,["value"])]),_:1}),r(l(s),{label:"\u9879\u76EE\u7B80\u4ECB",path:"content"},{default:n(()=>[r(l(c),{value:i.content,"onUpdate:value":e[9]||(e[9]=t=>i.content=t)},null,8,["value"])]),_:1}),r(l(s),{label:"Demo\u5730\u5740",path:"url"},{default:n(()=>[r(l(c),{value:i.url,"onUpdate:value":e[10]||(e[10]=t=>i.url=t)},null,8,["value"])]),_:1}),r(l(s),{label:"\u5C01\u9762\u5730\u5740",path:"cover"},{default:n(()=>[r(l(c),{value:i.cover,"onUpdate:value":e[11]||(e[11]=t=>i.cover=t)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}};export{be as default};
