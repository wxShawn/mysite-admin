import{z as G,r as h,A as y,au as H,B as J,C as Q,D as a,E as n,F as l,a2 as q,M as w,bv as W,G as z,H as f,N as C,I as c,J as X,bs as N,K as g,h as b}from"./index.c72cbd33.js";import{_ as Y}from"./UploadMedia.4d25b8ca.js";import{u as Z}from"./use-dialog.343bfb3a.js";import{N as ee}from"./DataTable.d27e045e.js";import{N as te}from"./a.2e491e65.js";import"./Add.e1d80b2f.js";import"./Pagination.7006eb39.js";const ae=g("\u67E5\u8BE2"),le=g("\u6DFB\u52A0\u89C6\u9891"),ne=g("\u590D\u5236"),oe=g("\u8FD4\u56DE"),se=g("\u66F4\u65B0"),ge={__name:"VideoList",setup(ie){const m=G(),F=Z(),S=h(null),v=y({name:""}),U=()=>{r.page=1,u()},_=h(!1),M=()=>{u(),_.value=!1},p=h(!1),A=h(null),d=y({id:null,name:"",url:""}),R=(e,t,o)=>{p.value=!0,Object.assign(d,{id:e,name:t,url:o})},D=async()=>{try{await navigator.clipboard.writeText(d.url),m.info("\u5DF2\u590D\u5236URL")}catch(e){console.warn(e),m.info("\u590D\u5236\u5931\u8D25")}},B=async()=>{const e=m.loading("\u66F4\u65B0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),t=await w.media.update(d.id,d.name);t.code===0&&(m.success(t.msg),u()),e.destroy(),p.value=!1},E=e=>{F.warning({title:"\u8B66\u544A",content:"\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F",positiveText:"\u786E\u8BA4\u5220\u9664",negativeText:"\u8003\u8651\u4E00\u4E0B",onPositiveClick:async()=>{const t=m.loading("\u5220\u9664\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0});(await w.media.delete(e)).code===0&&(m.success("\u5220\u9664\u6210\u529F"),u()),t.destroy()},onNegativeClick:()=>{}})},L=[{title:"\u540D\u79F0",key:"name",ellipsis:!0,width:250,render(e){return b(te,{href:e.url,target:"_blank",title:e.name},{default:()=>e.name})}},{title:"\u5927\u5C0F",key:"size"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"createdAt"},{title:"\u66F4\u65B0\u65F6\u95F4",key:"updatedAt"},{title:"\u64CD\u4F5C",key:"actions",render(e){return[b(c,{ghost:!0,type:"info",size:"small",style:"margin-right: 12px;",onclick:()=>R(e.id,e.name,e.url)},{default:()=>"\u7F16\u8F91"}),b(c,{ghost:!0,type:"error",size:"small",onClick:()=>E(e.id)},{default:()=>"\u5220\u9664"})]}}],k=y([]),u=async()=>{const{page:e,pageSize:t}=r,{name:o}=v,x=await w.media.findAllVideo(e,t,o);if(x.code===0){const{count:T,rows:i}=x.result;k.length=0,r.itemCount=T;for(let s=0,V=i.length;s<V;s++){const $=i[s].id,I=i[s].name,P=`${W.REQUEST_URL}/${i[s].path.split("uploads/",2)[1]}`,K=i[s].size>1024*1024?(i[s].size/1024/1024).toFixed(2)+" MB":(i[s].size/1024).toFixed(2)+" KB",O=new Date(i[s].createdAt).toLocaleString(),j=new Date(i[s].updatedAt).toLocaleString();k.push({id:$,name:I,url:P,size:K,createdAt:O,updatedAt:j})}}};H(()=>{u()});const r=y({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[{label:"10/\u9875",value:10},{label:"20/\u9875",value:20},{label:"30/\u9875",value:30}],prefix(){return`\u5171 ${r.itemCount} \u4E2A\u89C6\u9891\u6587\u4EF6`},onChange(e){r.page=e,u()},onUpdatePageSize(e){r.pageSize=e,r.page=1,u()}});return(e,t)=>(J(),Q(q,null,[a(l(X),null,{default:n(()=>[a(l(z),{ref_key:"searchFormRef",ref:S,inline:"",model:v},{default:n(()=>[a(l(f),{label:"\u89C6\u9891\u540D\u79F0"},{default:n(()=>[a(l(C),{value:v.name,"onUpdate:value":t[0]||(t[0]=o=>v.name=o)},null,8,["value"])]),_:1}),a(l(f),null,{default:n(()=>[a(l(c),{type:"info",onClick:U},{default:n(()=>[ae]),_:1})]),_:1}),a(l(f),null,{default:n(()=>[a(l(c),{type:"primary",onClick:t[1]||(t[1]=o=>_.value=!0)},{default:n(()=>[le]),_:1})]),_:1})]),_:1},8,["model"]),a(l(ee),{remote:"",columns:L,data:k,pagination:r},null,8,["data","pagination"])]),_:1}),a(l(N),{show:_.value,"onUpdate:show":t[2]||(t[2]=o=>_.value=o),class:"custom-card",preset:"card",style:{width:"500px"},title:"\u4E0A\u4F20\u89C6\u9891"},{default:n(()=>[a(Y,{accept:"video/*",onSuccess:M})]),_:1},8,["show"]),a(l(N),{show:p.value,"onUpdate:show":t[5]||(t[5]=o=>p.value=o),preset:"dialog",title:"\u89C6\u9891"},{action:n(()=>[a(l(c),{onClick:t[4]||(t[4]=o=>p.value=!1)},{default:n(()=>[oe]),_:1}),a(l(c),{type:"primary",onClick:B},{default:n(()=>[se]),_:1})]),default:n(()=>[a(l(z),{ref_key:"editFormRef",ref:A,style:{"margin-top":"30px"},"label-placement":"left",model:d},{default:n(()=>[a(l(f),{label:"\u89C6\u9891\u540D\u79F0"},{default:n(()=>[a(l(C),{value:d.name,"onUpdate:value":t[3]||(t[3]=o=>d.name=o)},null,8,["value"])]),_:1}),a(l(f),{label:"\u89C6\u9891\u5730\u5740"},{default:n(()=>[a(l(C),{value:d.url,disabled:""},null,8,["value"]),a(l(c),{style:{"margin-left":"20px"},onClick:D},{default:n(()=>[ne]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}};export{ge as default};
