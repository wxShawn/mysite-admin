import{A as b,r as k,au as I,h as U,I as y,M as A,z as P,B as q,C as E,D as l,E as o,F as e,a2 as H,G as M,H as x,N as T,J as L,bs as B,K as w,al as $}from"./index.8cc28b4e.js";import{u as j}from"./use-dialog.24af03bf.js";import{N as G}from"./DataTable.6c8f3b43.js";import"./Pagination.7ebfcf3c.js";const J=R=>{const m=b({name:""});return{formValue:m,search:async v=>{v(m.name)}}},K=()=>{const R=[{title:"#",key:"index"},{title:"\u5206\u7C7B\u540D\u79F0",key:"name"},{title:"\u6587\u7AE0\u6570\u91CF",key:"articleCount"},{title:"\u521B\u5EFA\u65F6\u95F4",key:"createdAt"},{title:"\u66F4\u65B0\u65F6\u95F4",key:"updatedAt"},{title:"\u64CD\u4F5C",key:"actions",render(t){return[U(y,{ghost:!0,style:"margin-right: 12px",type:"info",size:"small",onClick:()=>m.edit(t.id,t.name)},{default:()=>"\u7F16\u8F91"}),U(y,{ghost:!0,type:"error",size:"small",disabled:t.articleCount!=0,onClick:()=>m.delete(t.id)},{default:()=>"\u5220\u9664"})]}}],m={edit:(t,f)=>console.log("click edit",{id:t,name:f}),delete:t=>console.log("click delete",{id:t})},c=b([]),v=k(0),i=k(!1),z=async(t,f)=>await A.category.update(t,f),C=async t=>await A.category.delete(t),D=async t=>{if(!i.value){i.value=!0;const{page:f,pageSize:p}=u,N=await A.category.findAll(f,p,t);if(N.code===0){const{count:h,rows:g}=N.result;u.itemCount=h,c.length=0,v.value=0;for(let d=0,S=g.length;d<S;d++){v.value+=g[d].blog_articles.length;const r=new Date(g[d].createdAt).toLocaleString(),s=new Date(g[d].updatedAt).toLocaleString();c.push({index:(f-1)*p+d+1,id:g[d].id,name:g[d].name,articleCount:g[d].blog_articles.length,createdAt:r,updatedAt:s})}}i.value=!1}};I(()=>{D()});const u=b({page:1,pageSize:10,itemCount:0,showSizePicker:!0,pageSizes:[{label:"10/\u9875",value:10},{label:"20/\u9875",value:20},{label:"30/\u9875",value:30}],prefix(){return`\u5171 ${u.itemCount} \u4E2A\u5206\u7C7B, \u5305\u542B${v.value} \u7BC7\u6587\u7AE0`},onChange(t){u.page=t,F.change()},onUpdatePageSize(t){u.pageSize=t,u.page=1,F.change()}}),F=b({change(){}});return{columns:R,categoryData:c,pagination:u,getData:D,updateCategory:z,deleteCategory:C,action:m,paginationAction:F,loading:i}},O=w("\u67E5\u8BE2"),Q=w("\u6DFB\u52A0\u5206\u7C7B"),W=$("div",null,"\u7F16\u8F91\u5206\u7C7B",-1),X=w("\u53D6\u6D88"),Y=w("\u66F4\u65B0"),Z=$("div",null,"\u6DFB\u52A0\u5206\u7C7B",-1),ee=w("\u53D6\u6D88"),ae=w("\u6DFB\u52A0"),se={__name:"ArticleCategory",setup(R){const m=j(),c=P(),v=k(null),i=J(),z=()=>{i.search(async s=>{r.getData(s)})},C=k(!1),D=k(null),u=b({name:""}),F={name:{required:!0,trigger:"blur"}};let t=!1;const f=async()=>{try{await D.value.validate()}catch(s){return console.warn(s),!1}if(!t){t=!0;const s=c.loading("\u6DFB\u52A0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),{name:a}=u,n=await A.category.create(a);n.code===0&&(c.success(n.msg),C.value=!1,i.search(async _=>{r.getData(_)})),s.destroy(),t=!1}},p=k(!1),N=k(null),h=b({id:null,name:""}),g={name:{required:!0,trigger:"blur"}};let d=!1;const S=async()=>{try{await N.value.validate()}catch(s){return console.warn(s),!1}if(!d){d=!0;const s=c.loading("\u66F4\u65B0\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),{id:a,name:n}=h,_=await r.updateCategory(a,n);_.code===0&&(c.success(_.msg),p.value=!1,i.search(async V=>{r.getData(V)})),s.destroy(),d=!1}},r=K();return r.action.edit=(s,a)=>{Object.assign(h,{id:s,name:a}),p.value=!0},r.action.delete=s=>{let a=!1;m.warning({title:"\u8B66\u544A",content:"\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u9006\uFF0C\u786E\u8BA4\u5220\u9664\uFF1F",positiveText:"\u786E\u8BA4\u5220\u9664",negativeText:"\u8003\u8651\u4E00\u4E0B",onPositiveClick:async()=>{if(!a){a=!0;const n=c.loading("\u5220\u9664\u4E2D\uFF0C\u8BF7\u7A0D\u7B49...",{duration:0}),_=await r.deleteCategory(s);_.code===0&&(c.success(_.msg),i.search(async V=>{r.getData(V)})),n.destroy(),a=!1}},onNegativeClick:()=>{}})},r.paginationAction.change=()=>{i.search(async s=>{r.getData(s)})},(s,a)=>(q(),E(H,null,[l(e(L),null,{default:o(()=>[l(e(M),{ref_key:"searchFormRef",ref:v,inline:"","label-width":80,model:e(i).formValue},{default:o(()=>[l(e(x),{label:"\u5206\u7C7B\u540D\u79F0",path:"name"},{default:o(()=>[l(e(T),{value:e(i).formValue.name,"onUpdate:value":a[0]||(a[0]=n=>e(i).formValue.name=n)},null,8,["value"])]),_:1}),l(e(x),null,{default:o(()=>[l(e(y),{type:"info",onClick:z},{default:o(()=>[O]),_:1})]),_:1}),l(e(x),null,{default:o(()=>[l(e(y),{type:"primary",onClick:a[1]||(a[1]=n=>C.value=!0)},{default:o(()=>[Q]),_:1})]),_:1})]),_:1},8,["model"]),l(e(G),{remote:"",columns:e(r).columns,data:e(r).categoryData,pagination:e(r).pagination,loading:e(r).loading.value},null,8,["columns","data","pagination","loading"])]),_:1}),l(e(B),{show:p.value,"onUpdate:show":a[4]||(a[4]=n=>p.value=n),preset:"dialog",title:"Dialog"},{header:o(()=>[W]),action:o(()=>[l(e(y),{onClick:a[3]||(a[3]=n=>p.value=!1)},{default:o(()=>[X]),_:1}),l(e(y),{type:"primary",onClick:S},{default:o(()=>[Y]),_:1})]),default:o(()=>[l(e(M),{style:{"margin-top":"30px"},ref_key:"editCategoryFormRef",ref:N,"label-placement":"left",model:h,rules:g},{default:o(()=>[l(e(x),{label:"\u5206\u7C7B\u540D\u79F0",path:"name"},{default:o(()=>[l(e(T),{value:h.name,"onUpdate:value":a[2]||(a[2]=n=>h.name=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),l(e(B),{show:C.value,"onUpdate:show":a[7]||(a[7]=n=>C.value=n),preset:"dialog",title:"Dialog"},{header:o(()=>[Z]),action:o(()=>[l(e(y),{onClick:a[6]||(a[6]=n=>C.value=!1)},{default:o(()=>[ee]),_:1}),l(e(y),{type:"primary",onClick:f},{default:o(()=>[ae]),_:1})]),default:o(()=>[l(e(M),{style:{"margin-top":"30px"},ref_key:"addCategoryFormRef",ref:D,"label-placement":"left",model:u,rules:F},{default:o(()=>[l(e(x),{label:"\u5206\u7C7B\u540D\u79F0",path:"name"},{default:o(()=>[l(e(T),{value:u.name,"onUpdate:value":a[5]||(a[5]=n=>u.name=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64))}};export{se as default};
